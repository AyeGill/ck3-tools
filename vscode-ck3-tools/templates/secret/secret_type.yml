name: secret_type
description: Secret type definition - blackmailable information
category: secret
version: 1.0

parameters:
  name:
    type: string
    required: true
    description: Secret type name (e.g., secret_murder, secret_affair)

structure: |
  # Secret types define blackmailable information that can be discovered and exposed
  # Secrets have an owner (who has the secret) and optionally a target (who the secret is about)
  # Scopes available: scope:owner, scope:target, scope:secret

  {{name}} = {
  	# --- Category ---
  	# Options: adultery, murder, crime, religious, other
  	category = other

  	# --- Severity flags ---
  	# is_shunned: causes social penalties when exposed
  	# is_criminal: can be prosecuted, makes imprisonment valid
  	is_shunned = yes
  	is_criminal = no

  	# --- Validity ---
  	# When is this secret still relevant? Secret is removed if this returns false
  	is_valid = {
  		scope:owner = { is_alive = yes }
  		# scope:target = { is_alive = yes }  # if secret involves another person
  	}

  	# --- Already known? ---
  	# If true, the secret is public knowledge (no blackmail possible)
  	is_known = {
  		always = no
  		# Example: check if there's already a public record
  		# scope:owner = { has_character_flag = publicly_known_{{name}} }
  	}

  	# --- When secret is discovered by someone ---
  	on_discover = {
  		# scope:discoverer = the person who found out
  		# scope:owner = the person with the secret
  		# scope:target = the person the secret is about (if any)

  		# Typically give the discoverer a hook:
  		# scope:discoverer = {
  		# 	add_hook = {
  		# 		type = hook_secret
  		# 		target = scope:owner
  		# 		secret = scope:secret
  		# 	}
  		# }
  	}

  	# --- When secret is exposed publicly ---
  	on_expose = {
  		# scope:exposer = the person who revealed the secret
  		# scope:owner = the person with the secret

  		scope:owner = {
  			add_stress = 25
  			# add_prestige = -100
  			# Other consequences...
  		}

  		# If there's a target who was wronged:
  		# scope:target = {
  		# 	add_opinion = {
  		# 		target = scope:owner
  		# 		modifier = exposed_secret_opinion
  		# 		opinion = -30
  		# 	}
  		# }
  	}

  	# --- When secret owner dies ---
  	on_owner_death = {
  		# Clean up any flags, etc.
  	}

  	# --- Blackmail validity ---
  	# Under what conditions can someone blackmail with this secret?
  	blackmail_valid = {
  		scope:blackmailer = {
  			NOT = { this = scope:owner }
  		}
  	}

  	# --- AI behavior ---
  	# When will AI choose to expose rather than blackmail?
  	ai_will_expose = {
  		scope:exposer = {
  			opinion = { target = scope:owner value < -50 }
  		}
  	}
  }

  # --- To create this secret in effects: ---
  # scope:character = {
  # 	add_secret = {
  # 		type = {{name}}
  # 		target = scope:victim  # optional
  # 	}
  # }

localization:
  name_template: "{{capitalize (format_name name)}}"
  desc_template: "A {{format_name name}} secret."
